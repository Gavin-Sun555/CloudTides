import { __decorate, __param } from "tslib";
/*
 * Copyright (c) 2016-2020 VMware, Inc. All Rights Reserved.
 * This software is released under MIT license.
 * The full license information can be found in LICENSE in the root directory of this project.
 */
import { ChangeDetectorRef, ElementRef, Component, EventEmitter, Input, Optional, Output, AfterViewInit, ContentChildren, QueryList, OnInit, OnDestroy, } from '@angular/core';
// providers
import { AlertIconAndTypesService } from './providers/icon-and-types.service';
import { MultiAlertService } from './providers/multi-alert.service';
import { isBooleanAttributeSet } from '../../utils/component/is-boolean-attribute-set';
import { ClrCommonStringsService } from '../../utils/i18n/common-strings.service';
import { ClrAriaLiveService, ClrAriaLivePoliteness } from '../../utils/a11y/aria-live.service';
import { ClrAlertText } from './alert-text';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from '@angular/common';
import * as ɵngcc2 from '../../icon/icon';

function ClrAlert_div_0_button_3_Template(rf, ctx) { if (rf & 1) {
    const _r3 = ɵngcc0.ɵɵgetCurrentView();
    ɵngcc0.ɵɵelementStart(0, "button", 4);
    ɵngcc0.ɵɵlistener("click", function ClrAlert_div_0_button_3_Template_button_click_0_listener() { ɵngcc0.ɵɵrestoreView(_r3); const ctx_r2 = ɵngcc0.ɵɵnextContext(2); return ctx_r2.close(); });
    ɵngcc0.ɵɵelement(1, "clr-icon", 5);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r1 = ɵngcc0.ɵɵnextContext(2);
    ɵngcc0.ɵɵattribute("aria-label", ctx_r1.clrCloseButtonAriaLabel);
} }
function ClrAlert_div_0_Template(rf, ctx) { if (rf & 1) {
    ɵngcc0.ɵɵelementStart(0, "div", 1);
    ɵngcc0.ɵɵelementStart(1, "div", 2);
    ɵngcc0.ɵɵprojection(2);
    ɵngcc0.ɵɵelementEnd();
    ɵngcc0.ɵɵtemplate(3, ClrAlert_div_0_button_3_Template, 2, 1, "button", 3);
    ɵngcc0.ɵɵelementEnd();
} if (rf & 2) {
    const ctx_r0 = ɵngcc0.ɵɵnextContext();
    ɵngcc0.ɵɵclassProp("alert-hidden", ctx_r0.hidden)("alert-sm", ctx_r0.isSmall)("alert-app-level", ctx_r0.isAppLevel);
    ɵngcc0.ɵɵproperty("ngClass", ctx_r0.alertClass);
    ɵngcc0.ɵɵadvance(3);
    ɵngcc0.ɵɵproperty("ngIf", ctx_r0.closable);
} }
const _c0 = ["*"];
let ClrAlert = class ClrAlert {
    constructor(iconService, cdr, multiAlertService, commonStrings, ariaLiveService) {
        this.iconService = iconService;
        this.cdr = cdr;
        this.multiAlertService = multiAlertService;
        this.commonStrings = commonStrings;
        this.ariaLiveService = ariaLiveService;
        this.subscriptions = [];
        this.isSmall = false;
        this.closable = true;
        this.isAppLevel = false;
        // Aria
        this.clrCloseButtonAriaLabel = this.commonStrings.keys.alertCloseButtonAriaLabel;
        this._closed = false;
        this._closedChanged = new EventEmitter(false);
        /**
         * clrPolite is not used in the code. Is here just to provide
         * code complition and also mark component what type AriaLive
         * will be used.
         */
        /** @deprecated since 3.0, remove in 4.0 */
        this.polite = true;
    }
    ngOnInit() {
        if (this.multiAlertService) {
            this.subscriptions.push(this.multiAlertService.changes.subscribe(() => {
                this.hidden = this.multiAlertService.currentAlert !== this;
            }));
        }
    }
    ngOnDestroy() {
        this.subscriptions.forEach(sub => sub.unsubscribe());
    }
    ngAfterViewInit() {
        // Announce the first time the alert is render if it is not hidden
        this.announceAriaLiveMessage();
    }
    set alertType(val) {
        this.iconService.alertType = val;
    }
    get alertType() {
        return this.iconService.alertType;
    }
    /**
     * There is an order on how the attributes will take effect.
     * Assertive, Off, Polite.
     *
     * Polite is default if non is passed.
     *
     * In the case of setting all of them to true. Assertive will be used.
     *
     */
    get ariaLive() {
        if (isBooleanAttributeSet(this.assertive)) {
            return ClrAriaLivePoliteness.assertive;
        }
        if (isBooleanAttributeSet(this.off)) {
            return ClrAriaLivePoliteness.off;
        }
        return ClrAriaLivePoliteness.polite;
    }
    set alertIconShape(value) {
        this.iconService.alertIconShape = value;
    }
    get alertClass() {
        return this.iconService.iconInfoFromType(this.iconService.alertType).cssClass;
    }
    /**
     * This handle the find what content to be annonced withing the aria-live container
     * alerts that are hidden will be ignored.
     *
     * @remark
     * We depend on the ClrAlertText Directive to find and parse the alert messages.
     * Also this require the HTML markup for the alert to be
     * ```html
     * <div class="alert" role="alert">
     *    <div class="alert-items">
     *        <div class="alert-item static">
     *            <span class="alert-text">
     *                 ...
     *            </span>
     *        </div>
     *    </div>
     * </div>
     * ```
     */
    announceAriaLiveMessage() {
        if (!this.hidden && this.alertTexts.length) {
            const message = this.alertTexts.map(alertText => alertText.nativeElement.textContent).join(' ');
            // Don't call announce when there is nothing to say
            if (message) {
                this.ariaLiveService.announce(message, this.ariaLive);
            }
        }
    }
    set hidden(value) {
        if (value !== this._hidden) {
            this._hidden = value;
            this.cdr.detectChanges();
        }
    }
    get hidden() {
        return this._hidden;
    }
    close() {
        if (!this.closable) {
            return;
        }
        this._closed = true;
        if (this.multiAlertService) {
            this.multiAlertService.close();
        }
        this._closedChanged.emit(true);
    }
    open() {
        this._closed = false;
        this._closedChanged.emit(false);
    }
};
ClrAlert.ɵfac = function ClrAlert_Factory(t) { return new (t || ClrAlert)(ɵngcc0.ɵɵdirectiveInject(AlertIconAndTypesService), ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ChangeDetectorRef), ɵngcc0.ɵɵdirectiveInject(MultiAlertService, 8), ɵngcc0.ɵɵdirectiveInject(ClrCommonStringsService), ɵngcc0.ɵɵdirectiveInject(ClrAriaLiveService)); };
ClrAlert.ɵcmp = ɵngcc0.ɵɵdefineComponent({ type: ClrAlert, selectors: [["clr-alert"]], contentQueries: function ClrAlert_ContentQueries(rf, ctx, dirIndex) { if (rf & 1) {
        ɵngcc0.ɵɵcontentQuery(dirIndex, ClrAlertText, true, ElementRef);
    } if (rf & 2) {
        var _t;
        ɵngcc0.ɵɵqueryRefresh(_t = ɵngcc0.ɵɵloadQuery()) && (ctx.alertTexts = _t);
    } }, inputs: { isSmall: ["clrAlertSizeSmall", "isSmall"], closable: ["clrAlertClosable", "closable"], isAppLevel: ["clrAlertAppLevel", "isAppLevel"], clrCloseButtonAriaLabel: "clrCloseButtonAriaLabel", _closed: ["clrAlertClosed", "_closed"], polite: ["clrPolite", "polite"], alertType: ["clrAlertType", "alertType"], alertIconShape: ["clrAlertIcon", "alertIconShape"], assertive: ["clrAssertive", "assertive"], off: ["clrOff", "off"] }, outputs: { _closedChanged: "clrAlertClosedChange" }, features: [ɵngcc0.ɵɵProvidersFeature([AlertIconAndTypesService, ClrAriaLiveService])], ngContentSelectors: _c0, decls: 1, vars: 1, consts: [["class", "alert", 3, "ngClass", "alert-hidden", "alert-sm", "alert-app-level", 4, "ngIf"], [1, "alert", 3, "ngClass"], [1, "alert-items"], ["type", "button", "class", "close", 3, "click", 4, "ngIf"], ["type", "button", 1, "close", 3, "click"], ["shape", "close"]], template: function ClrAlert_Template(rf, ctx) { if (rf & 1) {
        ɵngcc0.ɵɵprojectionDef();
        ɵngcc0.ɵɵtemplate(0, ClrAlert_div_0_Template, 4, 8, "div", 0);
    } if (rf & 2) {
        ɵngcc0.ɵɵproperty("ngIf", !ctx._closed);
    } }, directives: [ɵngcc1.NgIf, ɵngcc1.NgClass, ɵngcc2.ClrIconCustomTag], styles: ["[_nghost-%COMP%] { display: block; }"] });
ClrAlert.ctorParameters = () => [
    { type: AlertIconAndTypesService },
    { type: ChangeDetectorRef },
    { type: MultiAlertService, decorators: [{ type: Optional }] },
    { type: ClrCommonStringsService },
    { type: ClrAriaLiveService }
];
__decorate([
    Input('clrAlertSizeSmall')
], ClrAlert.prototype, "isSmall", void 0);
__decorate([
    Input('clrAlertClosable')
], ClrAlert.prototype, "closable", void 0);
__decorate([
    Input('clrAlertAppLevel')
], ClrAlert.prototype, "isAppLevel", void 0);
__decorate([
    Input()
], ClrAlert.prototype, "clrCloseButtonAriaLabel", void 0);
__decorate([
    Input('clrAlertClosed')
], ClrAlert.prototype, "_closed", void 0);
__decorate([
    Output('clrAlertClosedChange')
], ClrAlert.prototype, "_closedChanged", void 0);
__decorate([
    Input('clrAlertType')
], ClrAlert.prototype, "alertType", null);
__decorate([
    Input('clrPolite')
], ClrAlert.prototype, "polite", void 0);
__decorate([
    Input('clrAssertive')
], ClrAlert.prototype, "assertive", void 0);
__decorate([
    Input('clrOff')
], ClrAlert.prototype, "off", void 0);
__decorate([
    Input('clrAlertIcon')
], ClrAlert.prototype, "alertIconShape", null);
__decorate([
    ContentChildren(ClrAlertText, { descendants: true, read: ElementRef })
], ClrAlert.prototype, "alertTexts", void 0);
ClrAlert = __decorate([ __param(2, Optional())
], ClrAlert);
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(ClrAlert, [{
        type: Component,
        args: [{
                selector: 'clr-alert',
                providers: [AlertIconAndTypesService, ClrAriaLiveService],
                template: "<!--\n  ~ Copyright (c) 2016-2020 VMware, Inc. All Rights Reserved.\n  ~ This software is released under MIT license.\n  ~ The full license information can be found in LICENSE in the root directory of this project.\n  -->\n\n<div\n    *ngIf=\"!_closed\"\n    class=\"alert\"\n    [ngClass]=\"alertClass\"\n    [class.alert-hidden]=\"hidden\"\n    [class.alert-sm]=\"isSmall\"\n    [class.alert-app-level]=\"isAppLevel\">\n    <div class=\"alert-items\">\n        <ng-content></ng-content>\n    </div>\n    <button\n        type=\"button\"\n        class=\"close\"\n        *ngIf=\"closable\"\n        (click)=\"close()\"\n        [attr.aria-label]=\"clrCloseButtonAriaLabel\"\n        >\n        <clr-icon shape=\"close\"></clr-icon>\n    </button>\n</div>\n",
                styles: [':host { display: block; }']
            }]
    }], function () { return [{ type: AlertIconAndTypesService }, { type: ɵngcc0.ChangeDetectorRef }, { type: MultiAlertService, decorators: [{
                type: Optional
            }] }, { type: ClrCommonStringsService }, { type: ClrAriaLiveService }]; }, { isSmall: [{
            type: Input,
            args: ['clrAlertSizeSmall']
        }], closable: [{
            type: Input,
            args: ['clrAlertClosable']
        }], isAppLevel: [{
            type: Input,
            args: ['clrAlertAppLevel']
        }], clrCloseButtonAriaLabel: [{
            type: Input
        }], _closed: [{
            type: Input,
            args: ['clrAlertClosed']
        }], _closedChanged: [{
            type: Output,
            args: ['clrAlertClosedChange']
        }], polite: [{
            type: Input,
            args: ['clrPolite']
        }], alertType: [{
            type: Input,
            args: ['clrAlertType']
        }], alertIconShape: [{
            type: Input,
            args: ['clrAlertIcon']
        }], assertive: [{
            type: Input,
            args: ['clrAssertive']
        }], off: [{
            type: Input,
            args: ['clrOff']
        }], alertTexts: [{
            type: ContentChildren,
            args: [ClrAlertText, { descendants: true, read: ElementRef }]
        }] }); })();
export { ClrAlert };

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYWxlcnQuanMiLCJzb3VyY2VzIjpbIm5nOi9AY2xyL2FuZ3VsYXIvZW1waGFzaXMvYWxlcnQvYWxlcnQudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IjtBQUFBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsR0FBRztBQUNILE9BQU8sRUFDTCxpQkFBaUIsRUFDakIsVUFBVSxFQUNWLFNBQVMsRUFDVCxZQUFZLEVBQ1osS0FBSyxFQUNMLFFBQVEsRUFDUixNQUFNLEVBQ04sYUFBYSxFQUNiLGVBQWUsRUFDZixTQUFTLEVBQ1QsTUFBTSxFQUNOLFNBQVMsR0FDVixNQUFNLGVBQWUsQ0FBQztBQUV2QixZQUFZO0FBQ1osT0FBTyxFQUFFLHdCQUF3QixFQUFFLE1BQU0sb0NBQW9DLENBQUM7QUFDOUUsT0FBTyxFQUFFLGlCQUFpQixFQUFFLE1BQU0saUNBQWlDLENBQUM7QUFDcEUsT0FBTyxFQUFFLHFCQUFxQixFQUFFLE1BQU0sZ0RBQWdELENBQUM7QUFDdkYsT0FBTyxFQUFFLHVCQUF1QixFQUFFLE1BQU0seUNBQXlDLENBQUM7QUFDbEYsT0FBTyxFQUFFLGtCQUFrQixFQUFFLHFCQUFxQixFQUFFLE1BQU0sb0NBQW9DLENBQUM7QUFDL0YsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLGNBQWMsQ0FBQzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBUzVDLElBQWEsUUFBUSxHQUFyQixNQUFhLFFBQVE7QUFBRyxJQUd0QixZQUNVLFdBQXFDLEVBQ3JDLEdBQXNCLEVBQ1YsaUJBQW9DLEVBQ2hELGFBQXNDLEVBQ3RDLGVBQW1DO0FBQzVDLFFBTFMsZ0JBQVcsR0FBWCxXQUFXLENBQTBCO0FBQUMsUUFDdEMsUUFBRyxHQUFILEdBQUcsQ0FBbUI7QUFBQyxRQUNYLHNCQUFpQixHQUFqQixpQkFBaUIsQ0FBbUI7QUFBQyxRQUNqRCxrQkFBYSxHQUFiLGFBQWEsQ0FBeUI7QUFBQyxRQUN2QyxvQkFBZSxHQUFmLGVBQWUsQ0FBb0I7QUFDL0MsUUFSVSxrQkFBYSxHQUFt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YixRQUFRLEVBQUUsWEFXSSxHQU5ILFFBQVEsQ0FtSnBCO1FBeEpzQixVQUNyQixTQUFTLEVBQUUsQ0FBQyx3QkFBd0IsRUFBRTtPQUFrQixDQUFDLFVBQ3pEOzs7O3duQkFBMkIsbUJBQ2xCLDJCQUEyQixPQUNyQyxDQUFDOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O29CQXFKRjtBQUFDLFNBcEpZLFFBQVE7QUFBSSIsInNvdXJjZXNDb250ZW50IjpbIi8qXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTYtMjAyMCBWTXdhcmUsIEluYy4gQWxsIFJpZ2h0cyBSZXNlcnZlZC5cbiAqIFRoaXMgc29mdHdhcmUgaXMgcmVsZWFzZWQgdW5kZXIgTUlUIGxpY2Vuc2UuXG4gKiBUaGUgZnVsbCBsaWNlbnNlIGluZm9ybWF0aW9uIGNhbiBiZSBmb3VuZCBpbiBMSUNFTlNFIGluIHRoZSByb290IGRpcmVjdG9yeSBvZiB0aGlzIHByb2plY3QuXG4gKi9cbmltcG9ydCB7XG4gIENoYW5nZURldGVjdG9yUmVmLFxuICBFbGVtZW50UmVmLFxuICBDb21wb25lbnQsXG4gIEV2ZW50RW1pdHRlcixcbiAgSW5wdXQsXG4gIE9wdGlvbmFsLFxuICBPdXRwdXQsXG4gIEFmdGVyVmlld0luaXQsXG4gIENvbnRlbnRDaGlsZHJlbixcbiAgUXVlcnlMaXN0LFxuICBPbkluaXQsXG4gIE9uRGVzdHJveSxcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbi8vIHByb3ZpZGVyc1xuaW1wb3J0IHsgQWxlcnRJY29uQW5kVHlwZXNTZXJ2aWNlIH0gZnJvbSAnLi9wcm92aWRlcnMvaWNvbi1hbmQtdHlwZXMuc2VydmljZSc7XG5pbXBvcnQgeyBNdWx0aUFsZXJ0U2VydmljZSB9IGZyb20gJy4vcHJvdmlkZXJzL211bHRpLWFsZXJ0LnNlcnZpY2UnO1xuaW1wb3J0IHsgaXNCb29sZWFuQXR0cmlidXRlU2V0IH0gZnJvbSAnLi4vLi4vdXRpbHMvY29tcG9uZW50L2lzLWJvb2xlYW4tYXR0cmlidXRlLXNldCc7XG5pbXBvcnQgeyBDbHJDb21tb25TdHJpbmdzU2VydmljZSB9IGZyb20gJy4uLy4uL3V0aWxzL2kxOG4vY29tbW9uLXN0cmluZ3Muc2VydmljZSc7XG5pbXBvcnQgeyBDbHJBcmlhTGl2ZVNlcnZpY2UsIENsckFyaWFMaXZlUG9saXRlbmVzcyB9IGZyb20gJy4uLy4uL3V0aWxzL2ExMXkvYXJpYS1saXZlLnNlcnZpY2UnO1xuaW1wb3J0IHsgQ2xyQWxlcnRUZXh0IH0gZnJvbSAnLi9hbGVydC10ZXh0JztcbmltcG9ydCB7IFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xuXG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdjbHItYWxlcnQnLFxuICBwcm92aWRlcnM6IFtBbGVydEljb25BbmRUeXBlc1NlcnZpY2UsIENsckFyaWFMaXZlU2VydmljZV0sXG4gIHRlbXBsYXRlVXJsOiAnLi9hbGVydC5odG1sJyxcbiAgc3R5bGVzOiBbJzpob3N0IHsgZGlzcGxheTogYmxvY2s7IH0nXSxcbn0pXG5leHBvcnQgY2xhc3MgQ2xyQWxlcnQgaW1wbGVtZW50cyBPbkluaXQsIE9uRGVzdHJveSwgQWZ0ZXJWaWV3SW5pdCB7XG4gIHByaXZhdGUgc3Vic2NyaXB0aW9uczogU3Vic2NyaXB0aW9uW10gPSBbXTtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBwcml2YXRlIGljb25TZXJ2aWNlOiBBbGVydEljb25BbmRUeXBlc1NlcnZpY2UsXG4gICAgcHJpdmF0ZSBjZHI6IENoYW5nZURldGVjdG9yUmVmLFxuICAgIEBPcHRpb25hbCgpIHByaXZhdGUgbXVsdGlBbGVydFNlcnZpY2U6IE11bHRpQWxlcnRTZXJ2aWNlLFxuICAgIHByaXZhdGUgY29tbW9uU3RyaW5nczogQ2xyQ29tbW9uU3RyaW5nc1NlcnZpY2UsXG4gICAgcHJpdmF0ZSBhcmlhTGl2ZVNlcnZpY2U6IENsckFyaWFMaXZlU2VydmljZVxuICApIHt9XG5cbiAgbmdPbkluaXQoKSB7XG4gICAgaWYgKHRoaXMubXVsdGlBbGVydFNlcnZpY2UpIHtcbiAgICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5wdXNoKFxuICAgICAgICB0aGlzLm11bHRpQWxlcnRTZXJ2aWNlLmNoYW5nZXMuc3Vic2NyaWJlKCgpID0+IHtcbiAgICAgICAgICB0aGlzLmhpZGRlbiA9IHRoaXMubXVsdGlBbGVydFNlcnZpY2UuY3VycmVudEFsZXJ0ICE9PSB0aGlzO1xuICAgICAgICB9KVxuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICBuZ09uRGVzdHJveSgpIHtcbiAgICB0aGlzLnN1YnNjcmlwdGlvbnMuZm9yRWFjaChzdWIgPT4gc3ViLnVuc3Vic2NyaWJlKCkpO1xuICB9XG5cbiAgbmdBZnRlclZpZXdJbml0KCkge1xuICAgIC8vIEFubm91bmNlIHRoZSBmaXJzdCB0aW1lIHRoZSBhbGVydCBpcyByZW5kZXIgaWYgaXQgaXMgbm90IGhpZGRlblxuICAgIHRoaXMuYW5ub3VuY2VBcmlhTGl2ZU1lc3NhZ2UoKTtcbiAgfVxuXG4gIEBJbnB1dCgnY2xyQWxlcnRTaXplU21hbGwnKSBpc1NtYWxsOiBib29sZWFuID0gZmFsc2U7XG4gIEBJbnB1dCgnY2xyQWxlcnRDbG9zYWJsZScpIGNsb3NhYmxlOiBib29sZWFuID0gdHJ1ZTtcbiAgQElucHV0KCdjbHJBbGVydEFwcExldmVsJykgaXNBcHBMZXZlbDogYm9vbGVhbiA9IGZhbHNlO1xuXG4gIC8vIEFyaWFcbiAgQElucHV0KCkgY2xyQ2xvc2VCdXR0b25BcmlhTGFiZWw6IHN0cmluZyA9IHRoaXMuY29tbW9uU3RyaW5ncy5rZXlzLmFsZXJ0Q2xvc2VCdXR0b25BcmlhTGFiZWw7XG5cbiAgQElucHV0KCdjbHJBbGVydENsb3NlZCcpIF9jbG9zZWQ6IGJvb2xlYW4gPSBmYWxzZTtcbiAgQE91dHB1dCgnY2xyQWxlcnRDbG9zZWRDaGFuZ2UnKSBfY2xvc2VkQ2hhbmdlZDogRXZlbnRFbWl0dGVyPGJvb2xlYW4+ID0gbmV3IEV2ZW50RW1pdHRlcjxib29sZWFuPihmYWxzZSk7XG5cbiAgQElucHV0KCdjbHJBbGVydFR5cGUnKVxuICBzZXQgYWxlcnRUeXBlKHZhbDogc3RyaW5nKSB7XG4gICAgdGhpcy5pY29uU2VydmljZS5hbGVydFR5cGUgPSB2YWw7XG4gIH1cblxuICBnZXQgYWxlcnRUeXBlKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIHRoaXMuaWNvblNlcnZpY2UuYWxlcnRUeXBlO1xuICB9XG5cbiAgLyoqXG4gICAqIGNsclBvbGl0ZSBpcyBub3QgdXNlZCBpbiB0aGUgY29kZS4gSXMgaGVyZSBqdXN0IHRvIHByb3ZpZGVcbiAgICogY29kZSBjb21wbGl0aW9uIGFuZCBhbHNvIG1hcmsgY29tcG9uZW50IHdoYXQgdHlwZSBBcmlhTGl2ZVxuICAgKiB3aWxsIGJlIHVzZWQuXG4gICAqL1xuICAvKiogQGRlcHJlY2F0ZWQgc2luY2UgMy4wLCByZW1vdmUgaW4gNC4wICovXG4gIEBJbnB1dCgnY2xyUG9saXRlJykgcG9saXRlOiBib29sZWFuID0gdHJ1ZTtcbiAgLyoqIEBkZXByZWNhdGVkIHNpbmNlIDMuMCwgcmVtb3ZlIGluIDQuMCAqL1xuICBASW5wdXQoJ2NsckFzc2VydGl2ZScpIGFzc2VydGl2ZTogYm9vbGVhbjtcbiAgLyoqIEBkZXByZWNhdGVkIHNpbmNlIDMuMCwgcmVtb3ZlIGluIDQuMCAqL1xuICBASW5wdXQoJ2Nsck9mZicpIG9mZjogYm9vbGVhbjtcbiAgLyoqXG4gICAqIFRoZXJlIGlzIGFuIG9yZGVyIG9uIGhvdyB0aGUgYXR0cmlidXRlcyB3aWxsIHRha2UgZWZmZWN0LlxuICAgKiBBc3NlcnRpdmUsIE9mZiwgUG9saXRlLlxuICAgKlxuICAgKiBQb2xpdGUgaXMgZGVmYXVsdCBpZiBub24gaXMgcGFzc2VkLlxuICAgKlxuICAgKiBJbiB0aGUgY2FzZSBvZiBzZXR0aW5nIGFsbCBvZiB0aGVtIHRvIHRydWUuIEFzc2VydGl2ZSB3aWxsIGJlIHVzZWQuXG4gICAqXG4gICAqL1xuICBnZXQgYXJpYUxpdmUoKTogQ2xyQXJpYUxpdmVQb2xpdGVuZXNzIHtcbiAgICBpZiAoaXNCb29sZWFuQXR0cmlidXRlU2V0KHRoaXMuYXNzZXJ0aXZlKSkge1xuICAgICAgcmV0dXJuIENsckFyaWFMaXZlUG9saXRlbmVzcy5hc3NlcnRpdmU7XG4gICAgfVxuICAgIGlmIChpc0Jvb2xlYW5BdHRyaWJ1dGVTZXQodGhpcy5vZmYpKSB7XG4gICAgICByZXR1cm4gQ2xyQXJpYUxpdmVQb2xpdGVuZXNzLm9mZjtcbiAgICB9XG4gICAgcmV0dXJuIENsckFyaWFMaXZlUG9saXRlbmVzcy5wb2xpdGU7XG4gIH1cblxuICBASW5wdXQoJ2NsckFsZXJ0SWNvbicpXG4gIHNldCBhbGVydEljb25TaGFwZSh2YWx1ZTogc3RyaW5nKSB7XG4gICAgdGhpcy5pY29uU2VydmljZS5hbGVydEljb25TaGFwZSA9IHZhbHVlO1xuICB9XG5cbiAgZ2V0IGFsZXJ0Q2xhc3MoKTogc3RyaW5nIHtcbiAgICByZXR1cm4gdGhpcy5pY29uU2VydmljZS5pY29uSW5mb0Zyb21UeXBlKHRoaXMuaWNvblNlcnZpY2UuYWxlcnRUeXBlKS5jc3NDbGFzcztcbiAgfVxuXG4gIEBDb250ZW50Q2hpbGRyZW4oQ2xyQWxlcnRUZXh0LCB7IGRlc2NlbmRhbnRzOiB0cnVlLCByZWFkOiBFbGVtZW50UmVmIH0pXG4gIGFsZXJ0VGV4dHM6IFF1ZXJ5TGlzdDxFbGVtZW50UmVmPjtcbiAgLyoqXG4gICAqIFRoaXMgaGFuZGxlIHRoZSBmaW5kIHdoYXQgY29udGVudCB0byBiZSBhbm5vbmNlZCB3aXRoaW5nIHRoZSBhcmlhLWxpdmUgY29udGFpbmVyXG4gICAqIGFsZXJ0cyB0aGF0IGFyZSBoaWRkZW4gd2lsbCBiZSBpZ25vcmVkLlxuICAgKlxuICAgKiBAcmVtYXJrXG4gICAqIFdlIGRlcGVuZCBvbiB0aGUgQ2xyQWxlcnRUZXh0IERpcmVjdGl2ZSB0byBmaW5kIGFuZCBwYXJzZSB0aGUgYWxlcnQgbWVzc2FnZXMuXG4gICAqIEFsc28gdGhpcyByZXF1aXJlIHRoZSBIVE1MIG1hcmt1cCBmb3IgdGhlIGFsZXJ0IHRvIGJlXG4gICAqIGBgYGh0bWxcbiAgICogPGRpdiBjbGFzcz1cImFsZXJ0XCIgcm9sZT1cImFsZXJ0XCI+XG4gICAqICAgIDxkaXYgY2xhc3M9XCJhbGVydC1pdGVtc1wiPlxuICAgKiAgICAgICAgPGRpdiBjbGFzcz1cImFsZXJ0LWl0ZW0gc3RhdGljXCI+XG4gICAqICAgICAgICAgICAgPHNwYW4gY2xhc3M9XCJhbGVydC10ZXh0XCI+XG4gICAqICAgICAgICAgICAgICAgICAuLi5cbiAgICogICAgICAgICAgICA8L3NwYW4+XG4gICAqICAgICAgICA8L2Rpdj5cbiAgICogICAgPC9kaXY+XG4gICAqIDwvZGl2PlxuICAgKiBgYGBcbiAgICovXG4gIHByaXZhdGUgYW5ub3VuY2VBcmlhTGl2ZU1lc3NhZ2UoKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLmhpZGRlbiAmJiB0aGlzLmFsZXJ0VGV4dHMubGVuZ3RoKSB7XG4gICAgICBjb25zdCBtZXNzYWdlID0gdGhpcy5hbGVydFRleHRzLm1hcChhbGVydFRleHQgPT4gYWxlcnRUZXh0Lm5hdGl2ZUVsZW1lbnQudGV4dENvbnRlbnQpLmpvaW4oJyAnKTtcbiAgICAgIC8vIERvbid0IGNhbGwgYW5ub3VuY2Ugd2hlbiB0aGVyZSBpcyBub3RoaW5nIHRvIHNheVxuICAgICAgaWYgKG1lc3NhZ2UpIHtcbiAgICAgICAgdGhpcy5hcmlhTGl2ZVNlcnZpY2UuYW5ub3VuY2UobWVzc2FnZSwgdGhpcy5hcmlhTGl2ZSk7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBfaGlkZGVuOiBib29sZWFuO1xuXG4gIHNldCBoaWRkZW4odmFsdWU6IGJvb2xlYW4pIHtcbiAgICBpZiAodmFsdWUgIT09IHRoaXMuX2hpZGRlbikge1xuICAgICAgdGhpcy5faGlkZGVuID0gdmFsdWU7XG4gICAgICB0aGlzLmNkci5kZXRlY3RDaGFuZ2VzKCk7XG4gICAgfVxuICB9XG5cbiAgZ2V0IGhpZGRlbigpIHtcbiAgICByZXR1cm4gdGhpcy5faGlkZGVuO1xuICB9XG5cbiAgY2xvc2UoKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLmNsb3NhYmxlKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuX2Nsb3NlZCA9IHRydWU7XG4gICAgaWYgKHRoaXMubXVsdGlBbGVydFNlcnZpY2UpIHtcbiAgICAgIHRoaXMubXVsdGlBbGVydFNlcnZpY2UuY2xvc2UoKTtcbiAgICB9XG4gICAgdGhpcy5fY2xvc2VkQ2hhbmdlZC5lbWl0KHRydWUpO1xuICB9XG5cbiAgb3BlbigpOiB2b2lkIHtcbiAgICB0aGlzLl9jbG9zZWQgPSBmYWxzZTtcbiAgICB0aGlzLl9jbG9zZWRDaGFuZ2VkLmVtaXQoZmFsc2UpO1xuICB9XG59XG4iXX0=