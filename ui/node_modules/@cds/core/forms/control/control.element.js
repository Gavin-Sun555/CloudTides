import{__decorate as t}from"tslib";import{LitElement as e,html as i}from"lit";import{query as s}from"lit/decorators/query.js";import{getElementLanguageDirection as o,baseStyles as a,hasAriaLabelTypeAttr as l,syncProps as r,describeElementByElements as n,getElementUpdates as d,childrenUpdateComplete as p,pxToRem as u,updateComponentLayout as h,property as c,state as y,querySlot as f,querySlotAll as v,id as m,event as g}from"@cds/core/internal";import{ClarityIcons as b}from"@cds/core/icon/icon.service.js";import{exclamationCircleIcon as x}from"@cds/core/icon/shapes/exclamation-circle.js";import{checkCircleIcon as L}from"@cds/core/icon/shapes/check-circle.js";import C from"./control.element.scss.js";import{syncHTML5Validation as A}from"../utils/validate.js";import{defaultControlWidth as T,defaultFormLayout as $,getStatusIcon as k,associateInputAndLabel as S,associateInputToDatalist as B,getCurrentMessageStatus as R,controlIsWrapped as z,formLayouts as D}from"../utils/index.js";var W;!function(t){t.default="default",t.ariaLabel="aria-label",t.inputGroup="input-group",t.hiddenLabel="hidden-label"}(W||(W={}));class j extends e{constructor(){super(),this.status="neutral",this.controlWidth=T,this.validate=!1,this.responsive=!0,this._layout=$,this.focused=!1,this.disabled=!1,this.readonly=!1,this.fixedControlWidth=!1,this.supportsPrefixSuffixActions=!0,this.labelLayout=W.default,this.observers=[],b.addIcons(x,L)}get layout(){return this._layout}set layout(t){const e=this._layout;this._layout=t?t.replace("-inline",""):$,this.requestUpdate("layout",e)}get isRTL(){return"rtl"===o(this)}static get styles(){return[a,C]}get hasAriaLabelTypeAttr(){return l(this.inputControl)}render(){var t;return i`${this.labelLayout===W.hiddenLabel||this.labelLayout===W.inputGroup?i`<span cds-layout="display:screen-reader-only"><slot name="label"></slot></span>`:""}<div cds-layout="${"vertical"===this.layout?"vertical gap:sm":"horizontal gap:lg"} align:stretch" class="private-host ${this.isRTL?"rtl":""}">${this.primaryLabelTemplate}<div class="input-message-container" cds-layout="
          wrap:none
          ${"compact"===this.layout?"horizontal":"vertical"}
          ${"stretch"!==this.controlWidth||this.fixedControlWidth?"":"align:horizontal-stretch"}
          ${(null===(t=this.messages)||void 0===t?void 0:t.length)?"gap:sm":""}"><div cds-layout="horizontal gap:sm wrap:none"><div cds-layout="horizontal align:top wrap:none ${"shrink"===this.controlWidth||this.fixedControlWidth?"align:shrink":"align:horizontal-stretch"}" class="input-container">${this.inputTemplate} ${this.prefixTemplate}<slot name="input"></slot>${this.suffixTemplate}</div>${this.labelLayout!==W.inputGroup?k(this.status):""}</div>${this.messagesTemplate}</div></div>`}get inputTemplate(){return i``}get prefixDefaultTemplate(){return null}get suffixDefaultTemplate(){return null}get hasControlActions(){return this.controlActions.length>0||this.prefixDefaultTemplate||this.suffixDefaultTemplate}get primaryLabelTemplate(){return i`${this.labelLayout===W.default?i`<cds-internal-control-label .disabled="${this.disabled}" cds-layout="align:shrink align:top" action="primary"><slot name="label"></slot></cds-internal-control-label>`:""}`}get messagesTemplate(){return i`<div cds-layout="${"compact"===this.layout?"align:shrink":""}" class="messages"><slot name="message"></slot></div>`}get prefixTemplate(){return i`<div cds-layout="align:shrink align:vertical-center" class="prefix"><div cds-layout="horizontal gap:xs">${this.prefixDefaultTemplate}<slot name="prefix"></slot></div></div>`}get suffixTemplate(){return i`<div cds-layout="align:shrink align:vertical-center" class="suffix"><div cds-layout="horizontal gap:xs"><slot name="suffix"></slot>${this.suffixDefaultTemplate}</div></div>`}connectedCallback(){super.connectedCallback(),this.setAttribute("cds-control","")}firstUpdated(t){super.firstUpdated(t),S(this.inputControl,this.label,this.inputControlId),B(this.inputControl,this.datalistControl),this.setupHostAttributes(),this.setupHTML5Validation(),this.setActionOffsetPadding(),this.setupResponsive(),this.setupDescribedByUpdates(),this.setupLabelLayout(),this.assignSlotIfInControlGroup()}updated(t){super.updated(t),this.messages.forEach((e=>r(e,this,{disabled:t.has("disabled")}))),r(this.inputControl,this,{disabled:t.has("disabled")})}disconnectedCallback(){super.disconnectedCallback(),this.observers.forEach((t=>t.disconnect()))}setupDescribedByUpdates(){var t;null===(t=this.messageSlot)||void 0===t||t.addEventListener("slotchange",(async()=>{n(this.inputControl,Array.from(this.messages)),R(Array.from(this.messages)).then((t=>this.status=t))}))}setupHostAttributes(){this.inputControl.addEventListener("focusin",(()=>this.focused=!0)),this.inputControl.addEventListener("focusout",(()=>this.focused=!1)),this.observers.push(d(this.inputControl,"disabled",(t=>this.disabled=""===t||t)),d(this.inputControl,"readonly",(t=>this.readonly=""===t||t)))}setupHTML5Validation(){var t,e;!(null===(e=null===(t=this.inputControl)||void 0===t?void 0:t.form)||void 0===e?void 0:e.noValidate)&&this.validate&&A(this,Array.from(this.messages))}async setActionOffsetPadding(){if(await p(this.controlActions),this.supportsPrefixSuffixActions&&this.hasControlActions){const t=u(this.prefixAction.getBoundingClientRect().width+6),e=u(this.suffixAction.getBoundingClientRect().width+6);this.inputControl.style.setProperty("padding-left",this.isRTL?e:t,"important"),this.inputControl.style.setProperty("padding-right",this.isRTL?t:e,"important")}}get layoutStable(){return this.labelLayout!==W.default||!z(this.inputControl,this.controlLabel,this.layout)}setupResponsive(){if(this.responsive&&this.labelLayout===W.default&&this.controlLabel){const t={layouts:D,initialLayout:this.layout},e=h(this,t,(()=>this.layoutChange.emit(this.layout,{bubbles:!0})));this.observers.push(e)}}setupLabelLayout(){var t,e;(null===(e=null===(t=this.label)||void 0===t?void 0:t.getAttribute("cds-layout"))||void 0===e?void 0:e.includes("display:screen-reader-only"))&&(this.labelLayout=W.hiddenLabel),this.hasAriaLabelTypeAttr&&(this.labelLayout=W.ariaLabel)}assignSlotIfInControlGroup(){var t;(null===(t=this.parentElement)||void 0===t?void 0:t.hasAttribute("cds-control-group"))&&this.setAttribute("slot","controls")}}t([c({type:String})],j.prototype,"status",void 0),t([c({type:String})],j.prototype,"controlWidth",void 0),t([c({type:Boolean})],j.prototype,"validate",void 0),t([c({type:Boolean})],j.prototype,"responsive",void 0),t([c({type:String})],j.prototype,"layout",null),t([y({type:Boolean,reflect:!0})],j.prototype,"focused",void 0),t([y({type:Boolean,reflect:!0})],j.prototype,"disabled",void 0),t([y({type:Boolean,reflect:!0})],j.prototype,"readonly",void 0),t([y()],j.prototype,"fixedControlWidth",void 0),t([y()],j.prototype,"supportsPrefixSuffixActions",void 0),t([y()],j.prototype,"isRTL",null),t([y()],j.prototype,"labelLayout",void 0),t([f("input, select, textarea, [cds-control]",{required:"error",requiredMessage:"input element is missing",assign:"input"})],j.prototype,"inputControl",void 0),t([f("label",{required:"error",requiredMessage:"To meet a11y standards either a <label> or input[aria-label] should be provided.",assign:"label",exemptOn:t=>t.hasAriaLabelTypeAttr})],j.prototype,"label",void 0),t([s("cds-internal-control-label[action=primary]")],j.prototype,"controlLabel",void 0),t([f("datalist")],j.prototype,"datalistControl",void 0),t([v("cds-control-message")],j.prototype,"messages",void 0),t([v("cds-control-action")],j.prototype,"controlActions",void 0),t([m()],j.prototype,"inputControlId",void 0),t([s(".prefix")],j.prototype,"prefixAction",void 0),t([s(".suffix")],j.prototype,"suffixAction",void 0),t([s(".messages")],j.prototype,"messageSlot",void 0),t([g()],j.prototype,"layoutChange",void 0);export{j as CdsControl,W as ControlLabelLayout};
//# sourceMappingURL=control.element.js.map
